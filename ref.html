<!DOCTYPE html>
<html>
<head>
    <title>Google Maps Routes API with Stops</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDAEXDncodFh19E9pCcBeQwykmQ_PVwOHs&libraries=geometry&callback=initMap" async defer></script>
    <script>
        let map;

        async function getRoute() {
            const apiKey = "AIzaSyDAEXDncodFh19E9pCcBeQwykmQ_PVwOHs";
            const url = `https://routes.googleapis.com/directions/v2:computeRoutes`;

            const requestBody = {
                origin: { location: { latLng: { latitude: 37.7749, longitude: -122.4194 } } }, // San Francisco
                destination: { location: { latLng: { latitude: 34.0522, longitude: -118.2437 } } }, // Los Angeles
                intermediates: [
                    { location: { latLng: { latitude: 35.3733, longitude: -119.0187 } } } // Bakersfield
                ],
                travelMode: "DRIVE",
                routingPreference: "TRAFFIC_AWARE"
            };

            const response = await fetch(url, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-Goog-Api-Key": apiKey,
                    "X-Goog-FieldMask": "routes.polyline"
                },
                body: JSON.stringify(requestBody)
            });

            const data = await response.json();
            if (data.routes && data.routes.length > 0) {
                const encodedPolyline = data.routes[0].polyline.encodedPolyline;
                drawRoute(encodedPolyline);
            } else {
                console.error("No route found", data);
            }
        }

        function drawRoute(encodedPolyline) {
            const decodedPath = google.maps.geometry.encoding.decodePath(encodedPolyline);
            const routePolyline = new google.maps.Polyline({
                path: decodedPath,
                geodesic: true,
                strokeColor: "#FF0000",
                strokeOpacity: 1.0,
                strokeWeight: 4
            });
            routePolyline.setMap(map);
        }

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 6,
                center: { lat: 36.5, lng: -120.5 } // Center between SF and LA
            });

            getRoute();
        }
    </script>
</head>
<body onload="initMap()">
    <div id="map" style="height: 500px; width: 100%;"></div>
</body>
</html>
